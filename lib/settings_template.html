<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hammerspoon ì„¤ì •</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        color: white;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 30px;
        backdrop-filter: blur(10px);
      }
      h1 {
        text-align: center;
        margin-bottom: 30px;
      }
      .section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input,
      select {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        box-sizing: border-box;
      }
      button {
        padding: 15px 30px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        margin: 5px;
      }
      .btn-save {
        background: #4caf50;
        color: white;
      }
      .btn-cancel {
        background: #f44336;
        color: white;
      }
      .button-group {
        text-align: center;
        margin-top: 30px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>âš™ï¸ Hammerspoon ì„¤ì •</h1>

      <div class="section">
        <h2>ğŸ“ Cursor ì„¤ì •</h2>
        <div class="form-group">
          <label for="defaultFolder">ê¸°ë³¸ í´ë” ê²½ë¡œ:</label>
          <input
            type="text"
            id="defaultFolder"
            placeholder="ì˜ˆ: /Users/username/Desktop/back"
            value="{{DEFAULT_FOLDER}}"
          />
        </div>
      </div>

      <div class="section">
        <h2>ğŸ¨ Chooser UI ì„¤ì •</h2>
        <div class="form-group">
          <label for="chooserWidth">í™”ë©´ ë„ˆë¹„ (%):</label>
          <input
            type="number"
            id="chooserWidth"
            min="10"
            max="90"
            value="{{CHOOSER_WIDTH}}"
          />
        </div>
        <div class="form-group">
          <label for="chooserRows">ìµœëŒ€ í‘œì‹œ ì¤„ ìˆ˜:</label>
          <input
            type="number"
            id="chooserRows"
            min="3"
            max="20"
            value="{{CHOOSER_ROWS}}"
          />
        </div>
        <div class="form-group">
          <label for="bgDark">ë‹¤í¬ ëª¨ë“œ:</label>
          <select id="bgDark">
            <option value="true" {{BG_DARK_TRUE}}>ì¼œê¸°</option>
            <option value="false" {{BG_DARK_FALSE}}>ë„ê¸°</option>
          </select>
        </div>
      </div>

      <div class="button-group">
        <button class="btn-save" onclick="saveSettings()">ğŸ’¾ ì €ì¥</button>
        <button class="btn-cancel" onclick="closeModal()">âŒ ë‹«ê¸°</button>
      </div>
    </div>

    <script>
      // Hammerspoon ê°ì²´ë¥¼ ì§ì ‘ ì •ì˜ (injectScript ëŒ€ì‹ )
      window.hammerspoon = {
        saveSettings: function (data) {
          // URL ë³€ê²½ìœ¼ë¡œ ë°ì´í„° ì „ë‹¬
          window.location.href = "hammerspoon://save?" + JSON.stringify(data);
        },
      };

      // ì„¤ì • ì €ì¥
      function saveSettings() {
        try {

          // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
          const defaultFolder = document.getElementById("defaultFolder").value;
          const chooserWidthElement = document.getElementById("chooserWidth");
          const chooserRowsElement = document.getElementById("chooserRows");
          const bgDarkElement = document.getElementById("bgDark");

          // ìš”ì†Œ ì¡´ì¬ í™•ì¸
          if (!chooserWidthElement || !chooserRowsElement || !bgDarkElement) {
            throw new Error("í•„ìˆ˜ ì…ë ¥ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
          }

          const chooserWidth = parseInt(chooserWidthElement.value);
          const chooserRows = parseInt(chooserRowsElement.value);
          const bgDark = bgDarkElement.value === "true";


          // ì…ë ¥ê°’ ê²€ì¦
          if (isNaN(chooserWidth) || chooserWidth < 10 || chooserWidth > 90) {
            throw new Error("Chooser ë„ˆë¹„ëŠ” 10-90 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤");
          }

          if (isNaN(chooserRows) || chooserRows < 3 || chooserRows > 20) {
            throw new Error("Chooser í–‰ ìˆ˜ëŠ” 3-20 ì‚¬ì´ì˜ ìˆ«ìì—¬ì•¼ í•©ë‹ˆë‹¤");
          }

          if (!defaultFolder || defaultFolder.trim() === "") {
            throw new Error("ê¸°ë³¸ í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
          }

          // ë°ì´í„° ê°ì²´ ìƒì„±
          const settingsData = {
            defaultFolder: defaultFolder.trim(),
            chooserWidth: chooserWidth,
            chooserRows: chooserRows,
            bgDark: bgDark,
          };


          // Hammerspoon ì—°ê²° í™•ì¸
          if (typeof window.hammerspoon === "undefined") {
            throw new Error("Hammerspoon ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
          }

          if (typeof window.hammerspoon.saveSettings !== "function") {
            throw new Error("saveSettings í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
          }


          // Hammerspoonì— ë°ì´í„° ì „ë‹¬
          window.hammerspoon.saveSettings(settingsData);
        } catch (error) {
          alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n\n" + error.message);
        }
      }

      // ëª¨ë‹¬ ë‹«ê¸°
      function closeModal() {
        try {
          window.close();
        } catch (error) {
          alert("ëª¨ë‹¬ì„ ë‹«ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Hammerspoonì„ í†µí•´ ë‹«ì•„ì£¼ì„¸ìš”.");
        }
      }

      // Hammerspoon ì£¼ì… ì™„ë£Œ ì½œë°±
      window.hammerspoonReady = function () {
        updateConnectionStatus(true);
      };

      // ì—°ê²° ìƒíƒœ ì—…ë°ì´íŠ¸
      function updateConnectionStatus(connected) {
        const statusElement = document.getElementById("connectionStatus");
        if (statusElement) {
          if (connected) {
            statusElement.textContent = "âœ… Hammerspoon ì—°ê²°ë¨";
            statusElement.style.color = "#4caf50";
          } else {
            statusElement.textContent = "âŒ Hammerspoon ì—°ê²° ëŒ€ê¸° ì¤‘...";
            statusElement.style.color = "#ff9800";
          }
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", function () {

        // ì—°ê²° ìƒíƒœ í‘œì‹œ ìš”ì†Œ ìƒì„±
        const statusDiv = document.createElement("div");
        statusDiv.id = "connectionStatus";
        statusDiv.style.cssText =
          "text-align: center; margin: 10px 0; font-weight: bold;";
        statusDiv.textContent = "âŒ Hammerspoon ì—°ê²° ëŒ€ê¸° ì¤‘...";
        statusDiv.style.color = "#ff9800";

        // ë²„íŠ¼ ê·¸ë£¹ ì•ì— ìƒíƒœ í‘œì‹œ ì‚½ì…
        const buttonGroup = document.querySelector(".button-group");
        if (buttonGroup && buttonGroup.parentNode) {
          buttonGroup.parentNode.insertBefore(statusDiv, buttonGroup);
        }

        // Hammerspoon ê°ì²´ í™•ì¸ (ì´ì œ ì§ì ‘ ì •ì˜ë˜ë¯€ë¡œ í•­ìƒ ì¡´ì¬í•´ì•¼ í•¨)
        if (
          typeof window.hammerspoon !== "undefined" &&
          typeof window.hammerspoon.saveSettings === "function"
        ) {
          // Hammerspoon ê°ì²´ í™•ì¸ë¨
          updateConnectionStatus(true);
        } else {
          // Hammerspoon ê°ì²´ê°€ ì˜ˆìƒê³¼ ë‹¤ë¦„
          updateConnectionStatus(false);

          // ì €ì¥ ë²„íŠ¼ ë¹„í™œì„±í™”
          const saveButton = document.querySelector(".btn-save");
          if (saveButton) {
            saveButton.disabled = true;
            saveButton.textContent = "âŒ ì—°ê²° ì‹¤íŒ¨";
            saveButton.style.opacity = "0.5";
          }
        }
      });
    </script>
  </body>
</html>
